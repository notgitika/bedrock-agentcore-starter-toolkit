
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
      <meta name="description" content="Documentation for Amazon Bedrock AgentCore, primitives for building and running AI agents">
    
    
    
      <link rel="canonical" href="https://aws.github.io/bedrock-agentcore-starter-toolkit/user-guide/policy/quickstart.html">
    
    
      <link rel="prev" href="../memory/quickstart.html">
    
    
      <link rel="next" href="overview.html">
    
    
    <link rel="icon" href="../.." sizes="any">
    <link rel="icon" href="../../assets/images/favicon.png" type="image/svg+xml">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">

    
      
        <title>Policy Quickstart - Amazon Bedrock AgentCore</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quickstart-policy-engine-in-5-minutes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Amazon Bedrock AgentCore" class="md-header__button md-logo" aria-label="Amazon Bedrock AgentCore" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon Bedrock AgentCore
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Policy Quickstart
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws/bedrock-agentcore-starter-toolkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../index.html" class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/index.html" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/aws/bedrock-agentcore-sdk-python/blob/main/CONTRIBUTING.md" class="md-tabs__link">
        
  
  
    
  
  Contribute ‚ù§Ô∏è

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api-reference/runtime.html" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Amazon Bedrock AgentCore" class="md-nav__button md-logo" aria-label="Amazon Bedrock AgentCore" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Amazon Bedrock AgentCore
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws/bedrock-agentcore-starter-toolkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../create/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dev/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Runtime
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Runtime
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/permissions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime Permissions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/async.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime Async Processing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/notebook.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime Notebook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/a2a.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime A2A Server Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Gateway
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Gateway
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gateway/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gateway Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Memory
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Memory
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" checked>
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Policy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Policy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Policy Quickstart
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="quickstart.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Quickstart
  

    
  </span>
  
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-setup-and-install" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Setup and Install
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-create-policy-setup-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create Policy Setup Script
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Create Policy Setup Script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-setup-script-step-by-step-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding the Setup Script ‚Äì Step-by-Step Explanation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-run-the-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Run the Setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-test-the-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Test the Policy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youve-built" class="md-nav__link">
    <span class="md-ellipsis">
      
        What You've Built
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cleanup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        CLI Reference
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Identity
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Identity
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identity/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identity Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identity/quickstart-with-cli.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identity CLI Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Built-in Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Built-in Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../builtin-tools/quickstart-browser.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart Browser Tool
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../builtin-tools/quickstart-code-interpreter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart Code Interpreter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/vpc-interface-endpoints.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VPC Interface Endpoints
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/agentcore-vpc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AgentCore VPC Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/security-vpc-condition.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VPC Condition Keys
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Observability
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Evaluation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Evaluation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluation Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Import Agent
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Import Agent
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../import-agent/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Import Agent Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../import-agent/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Import Agent Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../import-agent/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Import Agent Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/agentcore-quickstart-example.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime Transform and Deploy Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/session-management.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Session Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/async-processing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Async Processing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/gateway-integration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gateway Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/policy-integration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/memory_gateway_agent.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Gateway Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/runtime-framework-agents.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime Framework Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/semantic_search.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semantic Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/aws/bedrock-agentcore-sdk-python/blob/main/CONTRIBUTING.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contribute ‚ù§Ô∏è
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Bedrock AgentCore SDK
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Bedrock AgentCore SDK
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/runtime.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/identity.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/memory.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Built-in Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Bedrock AgentCore Starter Toolkit
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Bedrock AgentCore Starter Toolkit
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/cli.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AgentCore CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-setup-and-install" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Setup and Install
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-create-policy-setup-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create Policy Setup Script
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Create Policy Setup Script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-setup-script-step-by-step-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding the Setup Script ‚Äì Step-by-Step Explanation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-run-the-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Run the Setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-test-the-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Test the Policy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youve-built" class="md-nav__link">
    <span class="md-ellipsis">
      
        What You've Built
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cleanup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        CLI Reference
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="quickstart-policy-engine-in-5-minutes">QuickStart: Policy Engine in 5 Minutes! üöÄ<a class="headerlink" href="#quickstart-policy-engine-in-5-minutes" title="Permanent link">&para;</a></h1>
<p>Amazon Bedrock AgentCore Policy enables you to define and enforce fine-grained authorization policies for your AI agents using the Cedar policy language. This guide walks you through creating a Gateway with Policy Engine enforcement to govern agent tool calls.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>AgentCore Policy provides:</p>
<ul>
<li><strong>Policy Engines</strong>: Containers for organizing and managing related policies</li>
<li><strong>Cedar Policies</strong>: Fine-grained authorization rules using Amazon's Cedar policy language</li>
<li><strong>Gateway Integration</strong>: Seamless integration with AgentCore Gateway for runtime policy enforcement</li>
<li><strong>Deterministic Authorization</strong>: Policy evaluation happens outside agent code for consistent security</li>
</ul>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Before starting, make sure you have the following:</p>
<ul>
<li><strong>AWS Account</strong> with credentials configured</li>
<li><strong>Python 3.10+</strong> installed</li>
<li><strong>IAM permissions</strong> for creating roles, Lambda functions, Policy Engines, and using Amazon Bedrock AgentCore</li>
</ul>
<h2 id="step-1-setup-and-install">Step 1: Setup and Install<a class="headerlink" href="#step-1-setup-and-install" title="Permanent link">&para;</a></h2>
<p>Run the following in a terminal to set up the virtual environment:</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>agentcore-policy-quickstart
<span class="nb">cd</span><span class="w"> </span>agentcore-policy-quickstart
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate<span class="w">  </span><span class="c1"># On Windows: .venv\Scripts\activate</span>
</code></pre></div>
<p>Then install the dependencies:</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>boto3
pip<span class="w"> </span>install<span class="w"> </span>bedrock-agentcore-starter-toolkit
pip<span class="w"> </span>install<span class="w"> </span>requests
</code></pre></div>
<h2 id="step-2-create-policy-setup-script">Step 2: Create Policy Setup Script<a class="headerlink" href="#step-2-create-policy-setup-script" title="Permanent link">&para;</a></h2>
<p>Create a new file called <code>setup_policy.py</code> and insert the following complete code:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Setup script to create Gateway with Policy Engine</span>
<span class="sd">Run this first: python setup_policy.py</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore_starter_toolkit.operations.gateway.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">GatewayClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore_starter_toolkit.operations.policy.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolicyClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore_starter_toolkit.utils.lambda_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_lambda_function</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>


<span class="k">def</span><span class="w"> </span><span class="nf">setup_policy</span><span class="p">():</span>
    <span class="c1"># Configuration</span>
    <span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;us-west-2&quot;</span>
    <span class="n">refund_limit</span> <span class="o">=</span> <span class="mi">1000</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üöÄ Setting up AgentCore Gateway with Policy Engine...&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Region: </span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize clients</span>
    <span class="n">gateway_client</span> <span class="o">=</span> <span class="n">GatewayClient</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
    <span class="n">gateway_client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="n">policy_client</span> <span class="o">=</span> <span class="n">PolicyClient</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
    <span class="n">policy_client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="c1"># Step 1: Create OAuth authorizer</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step 1: Creating OAuth authorization server...&quot;</span><span class="p">)</span>
    <span class="n">cognito_response</span> <span class="o">=</span> <span class="n">gateway_client</span><span class="o">.</span><span class="n">create_oauth_authorizer_with_cognito</span><span class="p">(</span><span class="s2">&quot;PolicyGateway&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Authorization server created</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: Create Gateway</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step 2: Creating Gateway...&quot;</span><span class="p">)</span>
    <span class="n">gateway</span> <span class="o">=</span> <span class="n">gateway_client</span><span class="o">.</span><span class="n">create_mcp_gateway</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">role_arn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">authorizer_config</span><span class="o">=</span><span class="n">cognito_response</span><span class="p">[</span><span class="s2">&quot;authorizer_config&quot;</span><span class="p">],</span>
        <span class="n">enable_semantic_search</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Gateway created: </span><span class="si">{</span><span class="n">gateway</span><span class="p">[</span><span class="s1">&#39;gatewayUrl&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Fix IAM permissions</span>
    <span class="n">gateway_client</span><span class="o">.</span><span class="n">fix_iam_permissions</span><span class="p">(</span><span class="n">gateway</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚è≥ Waiting 30s for IAM propagation...&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì IAM permissions configured</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 3: Create Lambda function with refund tool</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step 3: Creating Lambda function with refund tool...&quot;</span><span class="p">)</span>

    <span class="n">refund_lambda_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">def lambda_handler(event, context):</span>
<span class="s2">    amount = event.get(&#39;amount&#39;, 0)</span>
<span class="s2">    return {</span>
<span class="s2">        &quot;status&quot;: &quot;success&quot;,</span>
<span class="s2">        &quot;message&quot;: f&quot;Refund of $</span><span class="si">{amount}</span><span class="s2"> processed successfully&quot;,</span>
<span class="s2">        &quot;amount&quot;: amount</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

    <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
    <span class="n">lambda_arn</span> <span class="o">=</span> <span class="n">create_lambda_function</span><span class="p">(</span>
        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">gateway_client</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="n">function_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RefundTool-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">lambda_code</span><span class="o">=</span><span class="n">refund_lambda_code</span><span class="p">,</span>
        <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;python3.13&quot;</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="s2">&quot;lambda_function.lambda_handler&quot;</span><span class="p">,</span>
        <span class="n">gateway_role_arn</span><span class="o">=</span><span class="n">gateway</span><span class="p">[</span><span class="s2">&quot;roleArn&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Refund tool for policy demo&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Lambda function created</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 4: Add Lambda target with refund tool schema</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step 4: Adding Lambda target with refund tool schema...&quot;</span><span class="p">)</span>
    <span class="n">lambda_target</span> <span class="o">=</span> <span class="n">gateway_client</span><span class="o">.</span><span class="n">create_mcp_gateway_target</span><span class="p">(</span>
        <span class="n">gateway</span><span class="o">=</span><span class="n">gateway</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;RefundTarget&quot;</span><span class="p">,</span>
        <span class="n">target_type</span><span class="o">=</span><span class="s2">&quot;lambda&quot;</span><span class="p">,</span>
        <span class="n">target_payload</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;lambdaArn&quot;</span><span class="p">:</span> <span class="n">lambda_arn</span><span class="p">,</span>
            <span class="s2">&quot;toolSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;inlinePayload&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;process_refund&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Process a customer refund&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;inputSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Refund amount in dollars&quot;</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">],</span>
                        <span class="p">},</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Lambda target added</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 5: Create Policy Engine</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step 5: Creating Policy Engine...&quot;</span><span class="p">)</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">policy_client</span><span class="o">.</span><span class="n">create_or_get_policy_engine</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;RefundPolicyEngine&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Policy engine to regulate refund operations&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Policy Engine: </span><span class="si">{</span><span class="n">engine</span><span class="p">[</span><span class="s1">&#39;policyEngineId&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 6: Create Cedar policy</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step 6: Creating Cedar policy (refund limit: $</span><span class="si">{</span><span class="n">refund_limit</span><span class="si">}</span><span class="s2">)...&quot;</span><span class="p">)</span>
    <span class="n">cedar_statement</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;permit(principal, &quot;</span>
        <span class="sa">f</span><span class="s1">&#39;action == AgentCore::Action::&quot;RefundTarget___process_refund&quot;, &#39;</span>
        <span class="sa">f</span><span class="s1">&#39;resource == AgentCore::Gateway::&quot;</span><span class="si">{</span><span class="n">gateway</span><span class="p">[</span><span class="s2">&quot;gatewayArn&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;) &#39;</span>
        <span class="s2">&quot;when { context.input.amount &lt; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">refund_limit</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; };&quot;</span>
    <span class="p">)</span>

    <span class="n">policy</span> <span class="o">=</span> <span class="n">policy_client</span><span class="o">.</span><span class="n">create_or_get_policy</span><span class="p">(</span>
        <span class="n">policy_engine_id</span><span class="o">=</span><span class="n">engine</span><span class="p">[</span><span class="s2">&quot;policyEngineId&quot;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;refund_limit_policy&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Allow refunds under $</span><span class="si">{</span><span class="n">refund_limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">definition</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cedar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;statement&quot;</span><span class="p">:</span> <span class="n">cedar_statement</span><span class="p">}},</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Policy: </span><span class="si">{</span><span class="n">policy</span><span class="p">[</span><span class="s1">&#39;policyId&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 7: Attach Policy Engine to Gateway</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step 7: Attaching Policy Engine to Gateway (ENFORCE mode)...&quot;</span><span class="p">)</span>
    <span class="n">gateway_client</span><span class="o">.</span><span class="n">update_gateway_policy_engine</span><span class="p">(</span>
        <span class="n">gateway_identifier</span><span class="o">=</span><span class="n">gateway</span><span class="p">[</span><span class="s2">&quot;gatewayId&quot;</span><span class="p">],</span>
        <span class="n">policy_engine_arn</span><span class="o">=</span><span class="n">engine</span><span class="p">[</span><span class="s2">&quot;policyEngineArn&quot;</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ENFORCE&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Policy Engine attached to Gateway</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 8: Save configuration</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gateway_url&quot;</span><span class="p">:</span> <span class="n">gateway</span><span class="p">[</span><span class="s2">&quot;gatewayUrl&quot;</span><span class="p">],</span>
        <span class="s2">&quot;gateway_id&quot;</span><span class="p">:</span> <span class="n">gateway</span><span class="p">[</span><span class="s2">&quot;gatewayId&quot;</span><span class="p">],</span>
        <span class="s2">&quot;gateway_arn&quot;</span><span class="p">:</span> <span class="n">gateway</span><span class="p">[</span><span class="s2">&quot;gatewayArn&quot;</span><span class="p">],</span>
        <span class="s2">&quot;policy_engine_id&quot;</span><span class="p">:</span> <span class="n">engine</span><span class="p">[</span><span class="s2">&quot;policyEngineId&quot;</span><span class="p">],</span>
        <span class="s2">&quot;policy_engine_arn&quot;</span><span class="p">:</span> <span class="n">engine</span><span class="p">[</span><span class="s2">&quot;policyEngineArn&quot;</span><span class="p">],</span>
        <span class="s2">&quot;policy_id&quot;</span><span class="p">:</span> <span class="n">policy</span><span class="p">[</span><span class="s2">&quot;policyId&quot;</span><span class="p">],</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
        <span class="s2">&quot;client_info&quot;</span><span class="p">:</span> <span class="n">cognito_response</span><span class="p">[</span><span class="s2">&quot;client_info&quot;</span><span class="p">],</span>
        <span class="s2">&quot;refund_limit&quot;</span><span class="p">:</span> <span class="n">refund_limit</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Setup complete!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gateway URL: </span><span class="si">{</span><span class="n">gateway</span><span class="p">[</span><span class="s1">&#39;gatewayUrl&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Policy Engine ID: </span><span class="si">{</span><span class="n">engine</span><span class="p">[</span><span class="s1">&#39;policyEngineId&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refund limit: $</span><span class="si">{</span><span class="n">refund_limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Configuration saved to: config.json&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Next step: Run &#39;python test_policy.py&#39; to test your Policy&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">config</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">setup_policy</span><span class="p">()</span>
</code></pre></div>
<h3 id="understanding-the-setup-script-step-by-step-explanation">Understanding the Setup Script ‚Äì Step-by-Step Explanation<a class="headerlink" href="#understanding-the-setup-script-step-by-step-explanation" title="Permanent link">&para;</a></h3>
<details>
<summary><strong>üìö Click to expand detailed explanation</strong></summary>

#### Import Required Libraries

<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore_starter_toolkit.operations.gateway.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">GatewayClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore_starter_toolkit.operations.policy.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolicyClient</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</code></pre></div>

#### Initialize Clients

<div class="highlight"><pre><span></span><code><span class="n">gateway_client</span> <span class="o">=</span> <span class="n">GatewayClient</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
<span class="n">policy_client</span> <span class="o">=</span> <span class="n">PolicyClient</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
</code></pre></div>

#### Create an OAuth Authorization Server

Gateways are secured by OAuth authorization servers. This creates an Amazon Cognito user pool with OAuth 2.0 configured.

#### Create a Gateway

The gateway acts as your MCP server endpoint that agents connect to. It manages OAuth authorization and enables semantic search for tool discovery.

#### Add Lambda Target

Creates a Lambda function with a refund tool that processes refund requests.

#### Create a Policy Engine

A policy engine is a collection of Cedar policies that evaluates and authorizes agent tool calls. The Policy Engine intercepts all requests at the Gateway boundary and determines whether to allow or deny each action based on the defined policies. This provides deterministic authorization outside of the agent's code, ensuring consistent security enforcement regardless of how the agent is implemented.

#### Create Cedar Policy

Cedar is an open-source policy language developed by AWS for writing authorization policies. This creates a Cedar policy that allows refunds under $1000:

<div class="highlight"><pre><span></span><code>permit(principal,
  action == AgentCore::Action::&quot;RefundTarget___process_refund&quot;,
  resource == AgentCore::Gateway::&quot;&lt;gateway-arn&gt;&quot;)
when {
  context.input.amount &lt; 1000
};
</code></pre></div>

The policy uses:

- **permit** - Allows the action (Cedar also supports `forbid` to deny actions)
- **principal** - The user making the request (OAuth-authenticated)
- **action** - The specific tool being called (RefundTarget___process_refund)
- **resource** - The Gateway instance where the policy applies
- **when condition** - Additional requirements (amount must be < $1000)

#### Attach Policy to Gateway

Attaches the Policy Engine to the Gateway in ENFORCE mode. In this mode:

- Every tool call is intercepted and evaluated against all policies
- By default, all actions are denied unless explicitly permitted
- If any `forbid` policy matches, access is denied (forbid-wins semantics)
- Policy decisions are logged to CloudWatch for monitoring and compliance

This ensures all agent operations through the Gateway are governed by your security policies.

</details>

<h2 id="step-3-run-the-setup">Step 3: Run the Setup<a class="headerlink" href="#step-3-run-the-setup" title="Permanent link">&para;</a></h2>
<p>Execute the setup script:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>setup_policy.py
</code></pre></div>
<p><strong>What to expect</strong>: The script will take about 2-3 minutes to complete.</p>
<h2 id="step-4-test-the-policy">Step 4: Test the Policy<a class="headerlink" href="#step-4-test-the-policy" title="Permanent link">&para;</a></h2>
<p>Create a file called <code>test_policy.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Test Policy Engine with direct HTTP calls to Gateway</span>
<span class="sd">Run after setup: python test_policy.py</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore_starter_toolkit.operations.gateway.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">GatewayClient</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_refund</span><span class="p">(</span><span class="n">gateway_url</span><span class="p">,</span> <span class="n">bearer_token</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test a refund request - print raw response&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">gateway_url</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">bearer_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;tools/call&quot;</span><span class="p">,</span>
            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;RefundTarget___process_refund&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">}</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status Code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response Body: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üß™ Testing Policy Engine&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Load configuration</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ùå Error: config.json not found!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please run &#39;python setup_policy.py&#39; first.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">gateway_url</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;gateway_url&quot;</span><span class="p">]</span>
    <span class="n">refund_limit</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;refund_limit&quot;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gateway: </span><span class="si">{</span><span class="n">gateway_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refund limit: $</span><span class="si">{</span><span class="n">refund_limit</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get access token</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üîë Getting access token...&quot;</span><span class="p">)</span>
    <span class="n">gateway_client</span> <span class="o">=</span> <span class="n">GatewayClient</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">])</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">gateway_client</span><span class="o">.</span><span class="n">get_access_token_for_cognito</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;client_info&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Token obtained</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Test 1: Refund $500 (should be allowed)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìù Test 1: Refund $500 (Expected: ALLOW)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">test_refund</span><span class="p">(</span><span class="n">gateway_url</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="c1"># Test 2: Refund $2000 (should be denied)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìù Test 2: Refund $2000 (Expected: DENY)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">test_refund</span><span class="p">(</span><span class="n">gateway_url</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Testing complete!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<p>Run the test:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>test_policy.py
</code></pre></div>
<h2 id="what-youve-built">What You've Built<a class="headerlink" href="#what-youve-built" title="Permanent link">&para;</a></h2>
<p>Through this tutorial, you've created:</p>
<ul>
<li><strong>MCP Server (Gateway)</strong>: A managed endpoint for tools</li>
<li><strong>Lambda function</strong>: Mock refund processing tool</li>
<li><strong>Policy Engine</strong>: Cedar-based policy evaluation system</li>
<li><strong>Cedar Policy</strong>: Governance rule allowing refunds under $1000</li>
<li><strong>OAuth authentication</strong>: Secure access using Cognito tokens</li>
</ul>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Issue</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>"AccessDeniedException"</td>
<td>Check IAM permissions for <code>bedrock-agentcore:*</code></td>
</tr>
<tr>
<td>Gateway not responding</td>
<td>Wait 30-60 seconds after creation for DNS propagation</td>
</tr>
<tr>
<td>OAuth token expired</td>
<td>Tokens expire after 1 hour, script gets new one automatically</td>
</tr>
</tbody>
</table>
<h2 id="cleanup">Cleanup<a class="headerlink" href="#cleanup" title="Permanent link">&para;</a></h2>
<p>Create a file called <code>cleanup_policy.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Cleanup script to remove Gateway and Policy Engine resources</span>
<span class="sd">Run this to clean up: python cleanup_policy.py</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore_starter_toolkit.operations.gateway.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">GatewayClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore_starter_toolkit.operations.policy.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolicyClient</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>


<span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># Clean up Policy Engine first</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üßπ Cleaning up Policy Engine...&quot;</span><span class="p">)</span>
    <span class="n">policy_client</span> <span class="o">=</span> <span class="n">PolicyClient</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">])</span>
    <span class="n">policy_client</span><span class="o">.</span><span class="n">cleanup_policy_engine</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;policy_engine_id&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Policy Engine cleaned up</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Then clean up Gateway</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üßπ Cleaning up Gateway...&quot;</span><span class="p">)</span>
    <span class="n">gateway_client</span> <span class="o">=</span> <span class="n">GatewayClient</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">])</span>
    <span class="n">gateway_client</span><span class="o">.</span><span class="n">cleanup_gateway</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;gateway_id&quot;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;client_info&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Cleanup complete!&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cleanup</span><span class="p">()</span>
</code></pre></div>
<p>Run the cleanup:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>cleanup_policy.py
</code></pre></div>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Custom Lambda Tools</strong>: Create Lambda functions with your business logic</li>
<li><strong>Add Your Own APIs</strong>: Extend your Gateway with OpenAPI specifications for real services</li>
<li><strong>Production Setup</strong>: Configure VPC endpoints, custom domains, and monitoring</li>
<li><strong>Advanced Policies</strong>: Create more complex Cedar policies with multiple conditions</li>
<li><strong>Policy Generation</strong>: Use natural language to generate Cedar policies (see CLI reference)</li>
</ul>
<h2 id="cli-reference">CLI Reference<a class="headerlink" href="#cli-reference" title="Permanent link">&para;</a></h2>
<p>For advanced operations using the AgentCore CLI, including policy generation from natural language and detailed policy management, see the <a href="../../api-reference/cli.html#policy-commands">Policy CLI Reference</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.copy", "content.code.select", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>